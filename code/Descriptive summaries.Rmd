---
title: "Descriptive summaries"
author: "Anshu Uppal"
date: "`r lubridate::today()`"
output: 
  html_document:
    code_folding: hide
knit: (function(input, ...) {
    rmarkdown::render(
      input, 
      output_dir = here::here("output")
    )
  })
---
```{r setup, results = "hide", message = FALSE, warning = FALSE}
knitr::opts_chunk$set(message = FALSE)  # Set default to not display code from chunks and not to display warnings
options(width = 300)
# Load packages and dataset ####
pacman::p_load(    # Installs / loads packages if they are not already installed / loaded
  rio,          # File import
  here,         # File locator
  skimr,        # get overview of data
  tidyverse,    # data management + ggplot2 graphics 
  gtsummary,    # summary statistics and tests
  rstatix,      # summary statistics and statistical tests
  janitor,      # adding totals and percents to tables
  scales,       # easily convert proportions to percents  
  flextable,    # converting tables to pretty images
  lubridate,     # manipulate date objects
  apyramid      # a package dedicated to creating age pyramids
)

# Read in clean dataset (see "Merge code.R" and "Cleaning merged dataset")
dat <- tibble(readRDS(here("data", "clean_dataset.rds")))
dat_all <- tibble(readRDS(here("data", "clean_dataset_incl_salariee.rds")))
```

# Descriptive summaries {.tabset}
## Variable summaries
### Date inclusion questionnaire was submitted
```{r}
dat %>% 
  ggplot(aes(x=date_soumission.x))+
  geom_histogram(binwidth = 10)
```

### BMI
We may need to recode the one with BMI=180 as NA for height/ width / BMI. I'm inclined to also do the same for those rows with height under 120cm, but I'm not 100% sure how we should treat those.
```{r bmi}
# BMI --> odd values to be removed?
dat %>%
ggplot(aes(x=height, y = weight.x, color = bmi>50))+
  geom_point()+
  geom_label(aes(label = if_else(bmi>50, round(bmi,0), NA)),
             vjust = "inward"
             )+
  theme_bw()
```

### Age and sex
Should also try and compare with the Geneva baseline population. Do we have this data already from other studies recently published by UEP?
```{r agesex}
dat %>% filter(sex_en != "Other") %>% # filter out the "Other" selections
  apyramid::age_pyramid(age_group = "age_cat",
                      split_by = "sex_en"
                      # , proportional = TRUE     # Display as % of all cases instead of counts
                      )
```

### Number of children
```{r}
dat %>% 
  ggplot(aes(x=children_n))+
  geom_histogram()
```

### Relationship status with number of children
```{r}
dat %>% 
  ggplot(aes(x=relation, fill = factor(children_n)))+
  geom_bar()+
  theme_bw()+
  theme(axis.text.x=element_text(angle = 30, hjust = 1, size = 15),
        axis.title.x = element_blank())
```

### Living situation with number of children
```{r}
dat %>% 
  ggplot(aes(x=hh_livewith_rec_en, fill = factor(children_n)))+
  geom_bar()+
  theme_bw()+
  theme(axis.text.x=element_text(angle = 20, hjust = 1, size = 18),
        axis.title.x = element_blank())
```

### Living situation with number of people in the household
Question asks for number of people living in household *aside* from the participant
```{r}
dat %>% 
  ggplot(aes(x=hh_livewith_rec_en, fill = hh_composition))+
  geom_bar()+
  theme_bw()+
  theme(axis.text.x=element_text(angle = 20, hjust = 1, size = 13),
        axis.title.x = element_blank())
```

### Education
We actually have very few participants with less than a secondary education level. Could we show the real breakdown in the tables, and then maybe dichotomize education into "Tertiary" and "Other" for analysis?
```{r}
dat %>% 
  ggplot(aes(x=education_rec_en))+
  geom_bar()+
  theme_bw()+
  geom_text(aes(label = ..count..), stat = "count", vjust = -0.2)+
  theme(axis.text.x=element_text(size = 18),
        axis.title.x = element_blank())
```

### Income
```{r income}
dat %>% 
  ggplot(aes(x=hh_income_cat_en))+
  geom_bar()+
  theme_bw()
```

### Urbanicity
```{r urbanicity}
dat %>% 
  ggplot(aes(x=zone_house))+
  geom_bar()+
  theme_bw()
```

### Income and Urbanicity
```{r income_urbanicity, out.width = "100%", fig.width=8, fig.height=5}
dat %>% 
  ggplot(aes(x=hh_income_cat_en, group = zone_house))+
  geom_bar(aes(y = ..prop.., fill = factor(..x..)), stat="count")+
  facet_grid(.~zone_house)+
  geom_text(aes(label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5)+
  theme_bw()+
  theme(axis.text.x=element_text(angle = 20, hjust = 1, size = 10),
        axis.title.x = element_blank())
  
```


## Likert scale outcomes {.tabset}
### Overinvestment in work
#### Full scale
Inverted scale for "I can relax and forget about work", so that all "Agrees" are a negative sentiment and all "Don't agrees" are a positive sentiment.
```{r overinvestment}
dat %>%
  select(participant_id, work_overinvestment_scale_rushed:work_overinvestment_scale_trouble_sleeping) %>%
  mutate(work_overinvestment_scale_relax = 5 - work_overinvestment_scale_relax) %>%  # This answer has an inverted scale, need to update it
  pivot_longer(
    cols = work_overinvestment_scale_rushed:work_overinvestment_scale_trouble_sleeping,
    names_to = "Overinvestment",
    values_to = "Response") %>%
  mutate(
    Overinvestment = recode(Overinvestment,
                                 "work_overinvestment_scale_rushed" = "I'm often rushed at work",
                                 "work_overinvestment_scale_problems" = "Think about work-related problems in the morning",
                                 "work_overinvestment_scale_relax" = "Unable to relax and forget about work",
                                 "work_overinvestment_scale_sacrifice" = "Friends say I sacrifice too much",
                                 "work_overinvestment_scale_head" = "Think about work when going to bed",
                                 "work_overinvestment_scale_trouble_sleeping" = "Trouble sleeping"
                                 ),
         Response_s = recode(Response,
                             "1" = "Absolutely don't agree",
                             "2" = "Don't agree",
                             "3" = "Agree",
                             "4" = "Absolutely agree"
                             )) %>%
  ggplot(aes(x=Response, fill = Response_s))+
  geom_bar()+
  facet_wrap(.~Overinvestment, labeller = label_wrap_gen(width = 25, multi_line = TRUE))+
  scale_fill_manual(            # color scales manually assigned
      values = c("Absolutely don't agree"  = "green4", # assigns colors
                "Don't agree"      = "green3",
                "Agree"      = "yellow",
                "Absolutely agree" = "red3"),
      breaks = c("Absolutely don't agree", "Don't agree", "Agree", "Absolutely agree") # orders the legend
      )+
  labs(fill="")+
  theme_bw()+
  theme(strip.text = element_text(size = 8),  # facet sub-titles
        axis.title.x = element_blank(),  # remove x-axis text
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()
        )
```


#### EE-MBI continuous score
```{r overinvestment_continous, fig.width=8}
dat %>%
  select(participant_id, burnout_score, burnout_interp_dich,  work_overinvestment_scale_rushed:work_overinvestment_scale_trouble_sleeping) %>%
  mutate(work_overinvestment_scale_relax = 5 - work_overinvestment_scale_relax) %>%  # Invert the scale for this question
  pivot_longer(
    cols = work_overinvestment_scale_rushed:work_overinvestment_scale_trouble_sleeping,
    names_to = "Overinvestment",
    values_to = "Response") %>%
  mutate(
    Overinvestment = recode(Overinvestment,
                            "work_overinvestment_scale_rushed" = "I'm often rushed at work",
                            "work_overinvestment_scale_problems" = "Think about work-related problems in the morning",
                            "work_overinvestment_scale_relax" = "Unable to relax and forget about work",
                            "work_overinvestment_scale_sacrifice" = "Friends say I sacrifice too much",
                            "work_overinvestment_scale_head" = "Think about work when going to bed",
                            "work_overinvestment_scale_trouble_sleeping" = "Trouble sleeping"
    ),
    Response = factor(Response),
    Response_s = recode(Response,
                        "1" = "Absolutely don't agree",
                        "2" = "Don't agree",
                        "3" = "Agree",
                        "4" = "Absolutely agree"
    )) %>%
  # Plot the values
  ggplot(aes(x=Response, y = burnout_score, fill = Response_s))+
  geom_bar(position = "dodge", stat = "summary", na.rm = TRUE, fun = "mean")+
  facet_wrap(.~Overinvestment, labeller = label_wrap_gen(width = 25, multi_line = TRUE))+
  labs(y ="Mean MBI Score", fill = "Response")+
  theme_bw()+
  theme(strip.text = element_text(size = 8),  # facet sub-titles
        # axis.text.x=element_text(angle = 20, hjust = 1, size = 10),
        axis.title.x = element_blank(),  # remove x-axis text
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()
  )
```

#### Scatterplot of Overinvestment score vs Square root of EE-MBI score
```{r}
dat %>% 
  ggplot(aes(x = score_work_overinvestment_scale, y = sqrt(burnout_score)))+
  geom_point()+
  geom_smooth()
```

#### Clinical burnout
```{r overinvestment_clinical}
dat %>%
  select(participant_id, burn_out, burnout_interp, burnout_interp_dich,  work_overinvestment_scale_rushed:work_overinvestment_scale_trouble_sleeping) %>%
  mutate(work_overinvestment_scale_relax = 5 - work_overinvestment_scale_relax) %>%  # This answer has an inverted scale, need to update it
  pivot_longer(
    cols = work_overinvestment_scale_rushed:work_overinvestment_scale_trouble_sleeping,
    names_to = "Overinvestment",
    values_to = "Response") %>%
  mutate(
    Overinvestment = recode(Overinvestment,
                            "work_overinvestment_scale_rushed" = "I'm often rushed at work",
                            "work_overinvestment_scale_problems" = "Think about work-related problems in the morning",
                            "work_overinvestment_scale_relax" = "Unable to relax and forget about work",
                            "work_overinvestment_scale_sacrifice" = "Friends say I sacrifice too much",
                            "work_overinvestment_scale_head" = "Think about work when going to bed",
                            "work_overinvestment_scale_trouble_sleeping" = "Trouble sleeping"
    ),
    Response = factor(Response),
    Response_s = recode(Response,
                        "1" = "Absolutely don't agree",
                        "2" = "Don't agree",
                        "3" = "Agree",
                        "4" = "Absolutely agree"
    )) %>%
  # Plot the values
  ggplot(aes(x=Response, y = burn_out, fill = Response_s))+
  geom_bar(position = "dodge", stat = "summary", na.rm = TRUE, fun = "mean")+
  facet_wrap(.~Overinvestment, labeller = label_wrap_gen(width = 25, multi_line = TRUE))+
  labs(x = "Response", y ="Clinial Burnout proportion", fill = "Response")+
  theme_bw()+
  theme(strip.text = element_text(size = 8),  # facet sub-titles
        axis.title.x = element_blank(),  # remove x-axis text
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()
  )
```

### Karasek Scale - Workplace stressors
#### Full scale
I inverted the scale for the questions on "I have too much work" and "I'm unable to maintain a work-life balance", so that all "Agree" responses reflect a positive sentiment and "Don't agree" responses represent a negative sentiment.
```{r karasek, fig.width=8}
dat %>%
  select(participant_id, karasek_scale_1_too_much_work:karasek_scale_3_colleagues_interested) %>%
mutate(
  karasek_scale_1_too_much_work = recode(karasek_scale_1_too_much_work, # Need to invert scale for these questions
                                         "D’accord" = "Pas d’accord",
                                         "Pas d’accord" = "D’accord",
                                         "Pas du tout d’accord" = "Tout à fait d’accord",
                                         "Tout à fait d’accord" = "Pas du tout d’accord"
                                         ),
  karasek_scale_1_work_life_balance = recode(karasek_scale_1_work_life_balance,
                                              "D’accord" = "Pas d’accord",
                                         "Pas d’accord" = "D’accord",
                                         "Pas du tout d’accord" = "Tout à fait d’accord",
                                         "Tout à fait d’accord" = "Pas du tout d’accord"
                                             )
  ) %>%
pivot_longer(
  cols = karasek_scale_1_too_much_work:karasek_scale_3_colleagues_interested,
  names_to = "Karasek_scale",
  values_to = "Response") %>%
  mutate(
    Response = fct_relevel(Response, c("Tout à fait d’accord", "D’accord", "Pas d’accord", "Pas du tout d’accord")),
    Karasek_scale = recode(Karasek_scale,
                           "karasek_scale_1_too_much_work" = "Not too much work",
                           "karasek_scale_1_work_organisation" = "Can self-organize work",
                           "karasek_scale_1_work_life_balance" = "Can maintain work-life balance",
                           "karasek_scale_1_work_satisfaction" = "Satisfied with job",
                           "karasek_scale_2_supervisor_collaboration" = "Manager facilitates collaboration",
                           "karasek_scale_2_supervisor_help" = "Manager is helpful",
                           "karasek_scale_2_colleagues_qualified" = "Colleagues are competent",
                           "karasek_scale_2_colleagues_help" = "Colleagues are helpful",
                           "karasek_scale_3_supervisor_attention" = "Manager pays attention to me",
                           "karasek_scale_3_supervisor_concerned" = "Manager takes care of team's wellbeing",
                           "karasek_scale_3_colleagues_friendly" = "Colleagues are friendly",
                           "karasek_scale_3_colleagues_interested" = "Colleagues show interest in me"
    ),
    Response_s = recode(Response,
                          "Pas du tout d’accord" = "Absolutely don't agree",
                          "Pas d’accord" = "Don't agree",
                          "D’accord" = "Agree",
                          "Tout à fait d’accord" = "Absolutely agree"
    )
  ) %>%
  ggplot(aes(x=Response, fill = Response_s))+
  geom_bar()+
  theme_bw()+
  facet_wrap(.~Karasek_scale, labeller = label_wrap_gen(width = 25, multi_line = TRUE))+
  scale_fill_manual(            # color scales manually assigned
    values = c("Absolutely agree"  = "green4", # assigns colors
               "Agree"      = "green3",
               "Don't agree"      = "yellow",
               "Absolutely don't agree" = "red3"),
    breaks = c("Absolutely agree", "Agree", "Don't agree", "Absolutely don't agree"))+ # orders the legend
  labs(fill="")+
  theme(strip.text = element_text(size = 8), # facet subtitles
        axis.title.x = element_blank(),  # remove x-axis text
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()
  )
```


#### EE-MBI continuos
```{r karasek_continuous, fig.width=8}
dat %>%
  select(participant_id, burn_out, burnout_score, burnout_interp, burnout_interp_dich, karasek_scale_1_too_much_work:karasek_scale_3_colleagues_interested) %>%
  mutate(
    karasek_scale_1_too_much_work = recode(karasek_scale_1_too_much_work, # Need to invert scale for these questions
                                           "D’accord" = "Pas d’accord",
                                           "Pas d’accord" = "D’accord",
                                           "Pas du tout d’accord" = "Tout à fait d’accord",
                                           "Tout à fait d’accord" = "Pas du tout d’accord"
    ),
    karasek_scale_1_work_life_balance = recode(karasek_scale_1_work_life_balance,
                                               "D’accord" = "Pas d’accord",
                                               "Pas d’accord" = "D’accord",
                                               "Pas du tout d’accord" = "Tout à fait d’accord",
                                               "Tout à fait d’accord" = "Pas du tout d’accord"
    )
  ) %>%
  pivot_longer(
    cols = karasek_scale_1_too_much_work:karasek_scale_3_colleagues_interested,
    names_to = "Karasek_scale",
    values_to = "Response") %>%
  mutate(
    Response = fct_relevel(Response, c("Tout à fait d’accord", "D’accord", "Pas d’accord", "Pas du tout d’accord")),
    Karasek_scale = recode(Karasek_scale,
                           "karasek_scale_1_too_much_work" = "Not too much work",
                           "karasek_scale_1_work_organisation" = "Can self-organize work",
                           "karasek_scale_1_work_life_balance" = "Can maintain work-life balance",
                           "karasek_scale_1_work_satisfaction" = "Satisfied with job",
                           "karasek_scale_2_supervisor_collaboration" = "Manager facilitates collaboration",
                           "karasek_scale_2_supervisor_help" = "Manager is helpful",
                           "karasek_scale_2_colleagues_qualified" = "Colleagues are competent",
                           "karasek_scale_2_colleagues_help" = "Colleagues are helpful",
                           "karasek_scale_3_supervisor_attention" = "Manager listens to what I say",
                           "karasek_scale_3_supervisor_concerned" = "Manager takes care of team's wellbeing",
                           "karasek_scale_3_colleagues_friendly" = "Colleagues are friendly",
                           "karasek_scale_3_colleagues_interested" = "Colleagues show interest in me"
    ),
    Response_s = recode(Response,
                          "Pas du tout d’accord" = "Absolutely don't agree",
                          "Pas d’accord" = "Don't agree",
                          "D’accord" = "Agree",
                          "Tout à fait d’accord" = "Absolutely agree"
    ),
    Response = factor(recode(Response,
                        "Pas du tout d’accord" = 1,
                        "Pas d’accord" = 2,
                        "D’accord" = 3,
                        "Tout à fait d’accord" = 4)
    )
  ) %>%
  # Plot the values
  ggplot(aes(x=Response, y = burnout_score, fill = Response_s))+
  geom_bar(position = "dodge", stat = "summary", na.rm = TRUE, fun = "mean")+
  facet_wrap(.~Karasek_scale, labeller = label_wrap_gen(width = 25, multi_line = TRUE))+
  labs(y = "Mean MBI score", fill = "Response")+
  theme_bw()+
  theme(strip.text = element_text(size = 8),  # facet sub-titles
        axis.title.x = element_blank(),  # remove x-axis text
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()
  )
```

#### Clinical burnout
```{r karasek_clinical, fig.width=8}
dat %>%
  select(participant_id, burn_out, burnout_interp, burnout_interp_dich, karasek_scale_1_too_much_work:karasek_scale_3_colleagues_interested) %>%
  mutate(
    karasek_scale_1_too_much_work = recode(karasek_scale_1_too_much_work, # Need to invert scale for these questions
                                           "D’accord" = "Pas d’accord",
                                           "Pas d’accord" = "D’accord",
                                           "Pas du tout d’accord" = "Tout à fait d’accord",
                                           "Tout à fait d’accord" = "Pas du tout d’accord"
    ),
    karasek_scale_1_work_life_balance = recode(karasek_scale_1_work_life_balance,
                                               "D’accord" = "Pas d’accord",
                                               "Pas d’accord" = "D’accord",
                                               "Pas du tout d’accord" = "Tout à fait d’accord",
                                               "Tout à fait d’accord" = "Pas du tout d’accord"
    )
  ) %>%
  pivot_longer(
    cols = karasek_scale_1_too_much_work:karasek_scale_3_colleagues_interested,
    names_to = "Karasek_scale",
    values_to = "Response") %>%
  mutate(
    Response = fct_relevel(Response, c("Tout à fait d’accord", "D’accord", "Pas d’accord", "Pas du tout d’accord")),
    Karasek_scale = recode(Karasek_scale,
                           "karasek_scale_1_too_much_work" = "Not too much work",
                           "karasek_scale_1_work_organisation" = "Can self-organize work",
                           "karasek_scale_1_work_life_balance" = "Can maintain work-life balance",
                           "karasek_scale_1_work_satisfaction" = "Satisfied with job",
                           "karasek_scale_2_supervisor_collaboration" = "Manager facilitates collaboration",
                           "karasek_scale_2_supervisor_help" = "Manager is helpful",
                           "karasek_scale_2_colleagues_qualified" = "Colleagues are competent",
                           "karasek_scale_2_colleagues_help" = "Colleagues are helpful",
                           "karasek_scale_3_supervisor_attention" = "Manager pays attention to me",
                           "karasek_scale_3_supervisor_concerned" = "Manager takes care of team's wellbeing",
                           "karasek_scale_3_colleagues_friendly" = "Colleagues are friendly",
                           "karasek_scale_3_colleagues_interested" = "Colleagues show interest in me"
    ),
    Response_s = recode(Response,
                          "Pas du tout d’accord" = "Absolutely don't agree",
                          "Pas d’accord" = "Don't agree",
                          "D’accord" = "Agree",
                          "Tout à fait d’accord" = "Absolutely agree"
    ),
    Response = factor(recode(Response,
                        "Pas du tout d’accord" = 1,
                        "Pas d’accord" = 2,
                        "D’accord" = 3,
                        "Tout à fait d’accord" = 4)
    )
  ) %>%
  # Plot the values
  ggplot(aes(x=Response, y = burn_out, fill = Response_s))+
  geom_bar(position = "dodge", stat = "summary", na.rm = TRUE, fun = "mean")+
  facet_wrap(.~Karasek_scale, labeller = label_wrap_gen(width = 25, multi_line = TRUE))+
  labs(x = "Response", y ="Clinial Burnout proportion", fill = "Response")+
  theme_bw()+
  theme(strip.text = element_text(size = 8),  # facet sub-titles
        axis.title.x = element_blank(),  # remove x-axis text
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()
  )
```

Scatterplot of Karasek vs EE-MBI
```{r}
dat %>% 
  ggplot(aes(x = karasek_social_support, y = burnout_score))+
  geom_point()+
  geom_smooth()
```

### MBI Emotional Exhaustion
#### Full scale
```{r MBI_Scale, fig.width=8}
dat %>%
  select(participant_id, burn_out,  points_burn_out_scale_1_emotional_exhaustion:points_burn_out_scale_2_exhausted) %>%
  pivot_longer(
    cols = points_burn_out_scale_1_emotional_exhaustion:points_burn_out_scale_2_exhausted,
    names_to = "MBI_EE",
    values_to = "Response") %>%
  mutate(
    MBI_EE = recode(MBI_EE,
                    "points_burn_out_scale_1_emotional_exhaustion" = "Emotionally exhausted from work",
                    "points_burn_out_scale_1_angry" = "Irritated after work",
                    "points_burn_out_scale_1_tired" = "Tired in the morning at the thought of facing work",
                    "points_burn_out_scale_1_much_effort" = "Working with others all day requires too much effort",
                    "points_burn_out_scale_1_mental_breakdown" = "Mentally breaking down due to work",
                    "points_burn_out_scale_2_frustrated" = "Frustrated by work",
                    "points_burn_out_scale_2_work_too_hard" = "Working too hard",
                    "points_burn_out_scale_2_too_stressed" = "Direct contact with people causes stress",
                    "points_burn_out_scale_2_exhausted" = "Exhausted from work"
                    ),
    Response_s = case_match(Response,
                            0 ~ "Never",
                            1 ~ "A few times a year",
                            2 ~ "Once a month",
                            3 ~ "A few times a month",
                            4 ~ "Once a week",
                            5 ~ "A few times a week",
                            6 ~ "Almost every day"
                            ),
    Response_s = fct_relevel(Response_s, c("Never", "A few times a year", "Once a month", "A few times a month",
                                           "Once a week","A few times a week","Almost every day")
                             )
  ) %>%
  ggplot(aes(x=Response, fill = Response_s))+
  geom_bar()+
  facet_wrap(.~ MBI_EE, labeller = label_wrap_gen(width = 25, multi_line = TRUE))+
  labs(fill = "Response")+
  theme_bw()+
  theme(strip.text = element_text(size = 8)  # facet sub-titles
        # axis.title.x = element_blank(),  # remove x-axis text
        # axis.text.x = element_blank(),
        # axis.ticks.x = element_blank()
        )
```

#### Continuous scale and MBI score interpretation
Not surprising that these match quite well, as the MBI score comes from this scale
```{r}
dat %>%
  select(participant_id, burn_out, burnout_interp, burnout_interp_dich, points_burn_out_scale_1_emotional_exhaustion:points_burn_out_scale_2_exhausted) %>%
  pivot_longer(
    cols = points_burn_out_scale_1_emotional_exhaustion:points_burn_out_scale_2_exhausted,
    names_to = "MBI_EE",
    values_to = "Response") %>%
  mutate(
    MBI_EE = recode(MBI_EE,
                    "points_burn_out_scale_1_emotional_exhaustion" = "Emotionally exhausted from work",
                    "points_burn_out_scale_1_angry" = "Irritated after work",
                    "points_burn_out_scale_1_tired" = "Tired in the morning at the thought of facing work",
                    "points_burn_out_scale_1_much_effort" = "Working with others all day requires too much effort",
                    "points_burn_out_scale_1_mental_breakdown" = "Mentally breaking down due to work",
                    "points_burn_out_scale_2_frustrated" = "Frustrated by work",
                    "points_burn_out_scale_2_work_too_hard" = "Working too hard",
                    "points_burn_out_scale_2_too_stressed" = "Direct contact with people causes stress",
                    "points_burn_out_scale_2_exhausted" = "Exhausted from work"
    ),
    Response_s = case_match(Response,
                            0 ~ "Never",
                            1 ~ "A few times a year",
                            2 ~ "Once a month",
                            3 ~ "A few times a month",
                            4 ~ "Once a week",
                            5 ~ "A few times a week",
                            6 ~ "Almost every day"
    ),
    Response_s = fct_relevel(Response_s, c("Never", "A few times a year", "Once a month", "A few times a month",
                                           "Once a week","A few times a week","Almost every day")
    )
  ) %>%
    # Plot the values
    ggplot(aes(x=burnout_interp_dich, y = Response))+
  geom_bar(position = "dodge", stat = "summary", na.rm = TRUE, fun = "mean")+
    facet_wrap(.~MBI_EE, labeller = label_wrap_gen(width = 25, multi_line = TRUE))+
    labs(x = "MBI score interpretation", y ="Mean Score (0 to 6)")+
    theme_bw()+
    theme(strip.text = element_text(size = 8),  # facet sub-titles
          # axis.title.x = element_blank(),  # remove x-axis text
          # axis.text.x = element_blank(),
          axis.ticks.x = element_blank()
    )
```

#### Continuous scale and clinical burnout
Higher scores in each dimension are nicely consistent with higher proportions of clinically diagnosed burnout in past 12 months.
```{r}
dat %>%
  select(participant_id, burn_out, burnout_interp, burnout_interp_dich, points_burn_out_scale_1_emotional_exhaustion:points_burn_out_scale_2_exhausted) %>%
  pivot_longer(
    cols = points_burn_out_scale_1_emotional_exhaustion:points_burn_out_scale_2_exhausted,
    names_to = "MBI_EE",
    values_to = "Response") %>%
  mutate(
    MBI_EE = recode(MBI_EE,
                    "points_burn_out_scale_1_emotional_exhaustion" = "Emotionally exhausted from work",
                    "points_burn_out_scale_1_angry" = "Irritated after work",
                    "points_burn_out_scale_1_tired" = "Tired in the morning at the thought of facing work",
                    "points_burn_out_scale_1_much_effort" = "Working with others all day requires too much effort",
                    "points_burn_out_scale_1_mental_breakdown" = "Mentally breaking down due to work",
                    "points_burn_out_scale_2_frustrated" = "Frustrated by work",
                    "points_burn_out_scale_2_work_too_hard" = "Working too hard",
                    "points_burn_out_scale_2_too_stressed" = "Direct contact with people causes stress",
                    "points_burn_out_scale_2_exhausted" = "Exhausted from work"
    ),
    Response_s = case_match(Response,
                            0 ~ "Never",
                            1 ~ "A few times a year",
                            2 ~ "Once a month",
                            3 ~ "A few times a month",
                            4 ~ "Once a week",
                            5 ~ "A few times a week",
                            6 ~ "Almost every day"
    ),
    Response = factor(Response),
    Response_s = fct_relevel(Response_s, c("Never", "A few times a year", "Once a month", "A few times a month",
                                           "Once a week","A few times a week","Almost every day")
    )
  ) %>%
    # Plot the values
    ggplot(aes(x=Response, y = burn_out, fill = Response_s))+
  geom_bar(position = "dodge", stat = "summary", na.rm = TRUE, fun = "mean")+
    facet_wrap(.~MBI_EE, labeller = label_wrap_gen(width = 25, multi_line = TRUE))+
  labs(x = "Response", y ="Clinial Burnout proportion", fill = "Response")+
    theme_bw()+
    theme(strip.text = element_text(size = 8),  # facet sub-titles
          axis.title.x = element_blank(),  # remove x-axis text
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank()
    )
```

#### Proportion of clinical burnout as a function of EE-MBI score
```{r}
dat %>% 
  group_by(burnout_score) %>% 
  summarise(burnout_prop = mean(burn_out, na.rm = TRUE)) %>% 
  ggplot(aes(x=burnout_score, y = burnout_prop))+
  geom_col()
```


## Summary tables, stratified by: {.tabset}
<!-- ############################################################## -->
<!-- Make a generic table without stratification, for later merging -->
<!-- ############################################################## -->
```{r tbl1_col_totals}

#####
####### Make the list of variables to include - this will be used for all tables
#####
var_included <- c("work_situation.y_dich",
  "burn_out", "burnout_interp_dich", "feeling_exhausted_dich", "wfh_updated", "wfh_cat", "wfh_change", "wfh_exposure", "wfh_balance",
  "serocov_work.y", "serocov_pop.y","sp4_avril_2022.y",
  "sex_en", "age_cat", "bmi_4_cat_en", "education_rec_en", "Swiss_nat", "ethnicity_dct", "ethn_dich",
  "relation", "children", "hh_livewith", "hh_composition", "zone_house",
  "housing_condition", "noisy", "quiet_room", "smoking_rec_en", "sedentary_work",
  "multiple_salaried_jobs", "job_sector", "hh_income_cat_en", "workplace_size", "workplace_size_dich", "supervision",
  # "wfh_change", "wfh_balance", 
  "finance_situation", "financial_difficulties",
  "fear_losing_job", "fear_losing_job_dich", "work_interruption", "work_interruption_dich",
  "exercise_hard", "exercise_hard_dich", "exercise_moderate", "exercise_moderate_dich",
  "health_general_dich", "mental_state_dich", "chronic_disease")

## Table of totals for the variables included ##
tbl1_col <- dat %>% select(all_of(var_included)) %>% 
  tbl_summary(
    percent = "col",                         # calculate percent column-wise
    label  = list(
      sex_en   ~ "Sex",
      age_cat ~ "Age category (years)",
      education_rec_en ~ "Education",
      Swiss_nat ~ "Nationality"
    ),
    type = all_categorical() ~ "categorical",                 # force all categorical levels to display
    missing_text = "Missing"                                   # how missing values should display
  ) %>%
  add_n() %>%                                        # Number of non-missing values
  modify_header(all_stat_cols() ~ "**Overall**") %>% 
  modify_spanning_header(everything() ~ NA) %>% 
  modify_footnote(all_stat_cols() ~ "Column-wise %") # ; tbl1_col
```

<!-- ############################################################## -->
<!-- Make the tables for each individual stratification variable -->
<!-- ############################################################## -->

<!-- WFH -->
```{r tbl1_wfh}
tbl1_wfh <- dat %>% select(all_of(var_included)) %>% 
  tbl_summary(
    by = wfh_updated,
    percent = "row",                         # calculate percent row-wise
    label  = list(
      sex_en   ~ "Sex",
      age_cat ~ "Age category (years)",
      education_rec_en ~ "Education",
      Swiss_nat ~ "Nationality"
                ),
    type = all_categorical() ~ "categorical",                 # force all categorical levels to display
    missing_text = "Missing"                                 # how missing values should display
) %>% 
  modify_spanning_header(all_stat_cols() ~ "**WFH frequency**") %>% 
  modify_footnote(all_stat_cols() ~ "Row-wise %") #;tbl1_wfh
```

<!-- WFH_cat -->
```{r tbl1_wfh_cat}
##
tbl1_wfh_cat <- dat %>% select(all_of(var_included)) %>% 
  tbl_summary(
    by = wfh_cat,
    percent = "row",                         # calculate percent row-wise
    label  = list(
      sex_en   ~ "Sex",
      age_cat ~ "Age category (years)",
      education_rec_en ~ "Education",
      Swiss_nat ~ "Nationality"
                ),
    type = all_categorical() ~ "categorical",                 # force all categorical levels to display
    missing_text = "Missing"                                 # how missing values should display
) %>% 
  modify_spanning_header(all_stat_cols() ~ "**WFH frequency**") %>% 
  modify_footnote(all_stat_cols() ~ "Row-wise %") #;tbl1_wfh_cat
```

<!-- WFH_exposure -->
```{r}
##
tbl1_wfh_exp <- dat %>% select(all_of(var_included)) %>% 
  tbl_summary(
    by = wfh_exposure,
    percent = "row",                         # calculate percent row-wise
    label  = list(
      sex_en   ~ "Sex",
      age_cat ~ "Age category (years)",
      education_rec_en ~ "Education",
      Swiss_nat ~ "Nationality"
                ),
    type = all_categorical() ~ "categorical",                 # force all categorical levels to display
    missing_text = "Missing"                                 # how missing values should display
) %>% 
  modify_spanning_header(all_stat_cols() ~ "**WFH Exposure combined**") %>% 
  modify_footnote(all_stat_cols() ~ "Row-wise %") #;tbl1_wfh_exp
```

<!-- ################## -->
<!-- Outcome variables -->
<!-- ################## -->
```{r tbl1_exhaustion}
##
tbl1_exhaustion <- dat %>% select(all_of(var_included)) %>% 
  tbl_summary(
    by = feeling_exhausted_dich,            # choose variable for stratification, comment out the others
    percent = "row",                         # calculate percent row-wise
    label  = list(
      sex_en   ~ "Sex",
      age_cat ~ "Age category (years)",
      education_rec_en ~ "Education",
      Swiss_nat ~ "Nationality"
                ),
    type = all_categorical() ~ "categorical",                 # force all categorical levels to display
    missing_text = "Missing"                                 # how missing values should display
) %>% 
  modify_spanning_header(all_stat_cols() ~ "**Exhaustion at work**") %>% 
  modify_footnote(all_stat_cols() ~ "Row-wise %") #;tbl1_exhaustion
```

```{r tbl1_burnout}
tbl1_burnout <- dat %>% select(all_of(var_included)) %>% 
  tbl_summary(                                           
    by = burn_out,
    percent = "row",                         # calculate percent row-wise
    label  = list(
      sex_en   ~ "Sex",
      age_cat ~ "Age category (years)",
      education_rec_en ~ "Education",
      Swiss_nat ~ "Nationality"
                ),
    type = all_categorical() ~ "categorical",                 # force all categorical levels to display
    missing_text = "Missing"                                  # how missing values should display
) %>% 
  modify_spanning_header(all_stat_cols() ~ "**Clinical Burnout**") %>% 
  modify_footnote(all_stat_cols() ~ "Row-wise %") #;tbl1_burnout
```

```{r tbl1_mbi}
tbl1_mbi <- dat %>% select(all_of(var_included)) %>% 
  tbl_summary(
    by = burnout_interp_dich,
    percent = "row",                         # calculate percent row-wise
    label  = list(
      sex_en   ~ "Sex",
      age_cat ~ "Age category (years)",
      education_rec_en ~ "Education",
      Swiss_nat ~ "Nationality"
                ),
    type = all_categorical() ~ "categorical",                 # force all categorical levels to display
    missing_text = "Missing"                                  # how missing values should display
) %>% 
  modify_spanning_header(all_stat_cols() ~ "**MBI (EE) interp.**") %>% 
  modify_footnote(all_stat_cols() ~ "Row-wise %") #;tbl1_mbi
```

```{r tbl1_mbi_score}
tbl1_mbi_score <- dat %>% select(all_of(var_included)) %>% 
  tbl_summary(
    by = burnout_interp_dich,
    percent = "row",                         # calculate percent row-wise
    label  = list(
      sex_en   ~ "Sex",
      age_cat ~ "Age category (years)",
      education_rec_en ~ "Education",
      Swiss_nat ~ "Nationality"
                ),
    type = all_categorical() ~ "categorical",                 # force all categorical levels to display
    missing_text = "Missing"                                  # how missing values should display
) %>% 
  modify_spanning_header(all_stat_cols() ~ "**MBI (EE) interp.**") %>% 
  modify_footnote(all_stat_cols() ~ "Row-wise %") #;tbl1_mbi_score
```

<!-- ############################################################## -->
<!-- Code for all of the merged tables, with tbl1_col as the reference -->
<!-- ############################################################## -->

<!-- ### WFH -->
<!-- ```{r wfh_combined} -->
<!-- tbl1_wfh_combined <- -->
<!--   tbl_merge( -->
<!--     tbls = list(tbl1_col, tbl1_wfh), -->
<!--     tab_spanner = c(NA, "**WFH frequency**") -->
<!--       ) ; tbl1_wfh_combined -->
<!-- ``` -->

### WFH (categorized)
```{r wfh_cat_combined}
tbl1_wfh_cat_combined <-
  tbl_merge(
    tbls = list(tbl1_col, tbl1_wfh_cat),
    tab_spanner = c(NA, "**WFH frequency**")
      ) ; tbl1_wfh_cat_combined
```

### WFH (combined exposure)
```{r wfh_exp_combined}
tbl1_wfh_exp_combined <-
  tbl_merge(
    tbls = list(tbl1_col, tbl1_wfh_exp),
    tab_spanner = c(NA, "**WFH Exposure combined**")
      ) ; tbl1_wfh_exp_combined
```

### Exhaustion
```{r tbl1_exhaustion_comb}
tbl1_exhaustion_combined <-
  tbl_merge(
    tbls = list(tbl1_col, tbl1_exhaustion),
    tab_spanner = c(NA, "**Exhaustion at work**")
      ) ; tbl1_exhaustion_combined
```

### Emotional Exhaustion
```{r tbl1_EE_dich_comb}
tbl1_exhaustion_combined <-
  tbl_merge(
    tbls = list(tbl1_col, tbl1_mbi),
    tab_spanner = c(NA, "**Emotional Exhaustion scale interp.**")
      ) ; tbl1_exhaustion_combined
```

### Clinical Burnout
```{r tbl1_clin_burnout}
tbl1_clin_burnout <-
  tbl_merge(
    tbls = list(tbl1_col, tbl1_burnout),
    tab_spanner = c(NA, "**Clinical burnout**")
      ) ; tbl1_clin_burnout
```

### Salaried vs unsalaried
<!-- ############################################################## -->
<!-- Make a generic table without stratification, for later merging -->
<!-- ############################################################## -->
```{r tbl1_col_totals_all}
## Table of totals for the variables included ##
tbl1_col_all <- dat_all %>% select(work_situation.y_dich, all_of(var_included)) %>% 
  tbl_summary(
    percent = "col",                         # calculate percent column-wise
    label  = list(
      sex_en   ~ "Sex",
      age_cat ~ "Age category (years)",
      education_rec_en ~ "Education",
      Swiss_nat ~ "Nationality"
    ),
    type = all_categorical() ~ "categorical",                 # force all categorical levels to display
    missing_text = "Missing"                                   # how missing values should display
  ) %>%
  add_n() %>%                                        # Number of non-missing values
  modify_header(all_stat_cols() ~ "**Overall**") %>% 
  modify_spanning_header(everything() ~ NA) %>% 
  modify_footnote(all_stat_cols() ~ "Column-wise %") # ; tbl1_col_all
```

```{r tbl1_work_all}
tbl1_work_all <- dat_all %>% select(work_situation.y_dich, all_of(var_included)) %>% 
  tbl_summary(
    by = work_situation.y_dich,
    percent = "col",                         # calculate percent row-wise
    label  = list(
      sex_en   ~ "Sex",
      age_cat ~ "Age category (years)",
      education_rec_en ~ "Education",
      Swiss_nat ~ "Nationality"
                ),
    type = all_categorical() ~ "categorical",                 # force all categorical levels to display
    missing_text = "Missing"                                  # how missing values should display
) %>% 
  modify_spanning_header(all_stat_cols() ~ "**MBI (EE) interp.**") %>% 
  modify_footnote(all_stat_cols() ~ "Column-wise %") #;tbl1_work_all
```

```{r tbl1_work_combined}
tbl1_clin_burnout <-
  tbl_merge(
    tbls = list(tbl1_col_all, tbl1_work_all),
    tab_spanner = c(NA, "**Current working situation**")
      ) ; tbl1_clin_burnout
```
